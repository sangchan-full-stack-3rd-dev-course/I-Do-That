# 일자 : 24.05.14

## 1. 오늘 내용

### (1) next()
- 전날에 발생했던 요청 시 무한 대기 오류를 해결하는 방법을 배움.
- 내 생각으로는 validate함수에서 에러가 발생하지 않으면 본 api 처리 함수로 넘어 갈 줄 알았음.
- 하지만, 제대로 넘어가기 위해서는 next를 사용해야 했음.
- 이를 통해서 validate를 미들웨어로 제대로 사용할 수 있게 됨.
- 이 뿐만 아니라, 앞으로 jwt 검사하는 미들웨어를 만들 때 사용할 수 있어보임.

### (2) 인증과 인가
- 인증 (Authentication = login)
    - 사이트의 **핵심 기능을 이용**하기 위한 절차
    - 사이트에 **가입된 사용자임을 증명**하는 것.
    - (session = 로그인 상태)

- 인가 (Authorization = 권한)
    - 같은 사이트 내의 사용자마다 권한이 다름.
    - ex : 관리자 / VIP / 일반사용자
    - 권한마다 접근, 사용할 수 있는 기능이 다름.
    - 인증 이후에, **사용자의 권한을 확인**하는 절차

### (3) 로그인 상태 관리 방법
- Cookie
    - 로컬에 저장된다.
    - 과정
        - 1. 클라이언트 : 로그인 요청을 서버로 전송 (email, password)
        - 2. 서버 : 사용자를 확인하고 개인정보를 쿠키에 저장
        - 3. 클라이언트 : 이후 요청에는 쿠키를 함께 전송함.
    
    - 장점
        - Stateless : 서버가 사용자 로그인 상태를 기억하지 않음 -> RESTful
    - 단점
        - 보안 : 요청마다 쿠키를 전송 -> 쿠키 탈취 시 개인 정보 유츌 위험

- Session
    - 서버에서 사용자의 로그인 상태를 기억 (저장, 관리).
    - 클라이언트에는 session id 만 전달함.
    - 과정
        - 1. 클라이언트 : 로그인 요청을 서버로 전송
        - 2. 서버 : 사용자를 확인하고 개인정보를 서버 세션에 저장 + session id 응답
        - (이 때, 세션은 memory or DB)
        - 3. 클라이언트 : 이후 요청 시 마다 session id로 사용자 확인

    - 장점
        - 보안 : 사용자는 session id만 가지고 있음 -> 탈취되도 개인 정보는 ㄱㅊ
    - 단점
        - 과부하 : 서버에서 로그인 상태를 저장 -> 사용자 많아질수록 메모리 사용 증가 -> 과부하
        - stateless 하지 않음

- JWT
    - JSON 형태의 데이터를 안전하게 전송하기 위해 웹에서 사용하는 토큰
    - 사용자가 스스로를 "증명"하기위한 수단
    - cookie와 session의 단점을 보완

    - 장점
        - 보안 강함 : 특정 알고리즘으로 암호화
        - stateless -> 서버 부담 감소

    - 구조
        - HEADER
            - 암호화 알고리즘
            - 토큰의 형태(Type)
        - PAYLOAD
            - 사용자 개인 정보
            - iat (issued at = 토큰 발행 시간)
        - VERIFY SIGNATURE
            - 서명 (데이터 무결성 보장)
            - 페이로드 값이 변하면 서명값도 변함 -> 서버에서는 이를 확인하므로 JWT 신뢰 가능
    
    - 인증 및 인가 절차
        - 로그인
            - 1. 클라이언트 : POST /login {email, password} 요청 전송
            - 2. 서버 : 입력 데이터 확인 -> JWT 발행 후 쿠키에 저장 + 성공 응답
        
        - 토큰 발급 이후
            - 1. 클라이언트 : 요청 시마다, JWT 함께 전송
            - 2. 서버 : JWT 검증(무결성, 토큰 만료 등) -> 요청에 따른 응답